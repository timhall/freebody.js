// Freebody.js - Free-body mechanics / physics engine in javascript
// (c) Tim Hall - https://github.com/timhall/freebody.js - License: MIT

var freebody=function(t,n,e){"use strict";var r={},o=r.utils={};o.radians=function(t){return t*(Math.PI/180)},o.degrees=function(t){return t*(180/Math.PI)},o.hypotenuse=function(t,n){return Math.sqrt(Math.pow(t,2)+Math.pow(n,2))},o.roundToDec=function(t,n){var e=Math.pow(10,n);return Math.round(t*e)/e},o.roundToPrecision=function(t,n){var e=Math.round(o.log10(1/(n||1)));return o.roundToDec(t,e)},o.log10=function(t){return Math.log(t)/Math.LN10},o.distance=function(t,n){return o.hypotenuse(t.x-n.x,t.y-n.y)},o.angle=function(t,n){return o.degrees(Math.atan2(n.y-t.y,n.x-t.x))};var i=r.Vector=function(t,n){return this._magnitude=t||0,this._angle=n||0,this};i.prototype.magnitude=function(t){return t!==e?(this._magnitude=t,this):this._magnitude},i.prototype.angle=function(t){return t!==e?(this._angle=t,this):this._angle},i.prototype.x=function(t){return t!==e?(a(this,t,this.y()),this):this._magnitude*Math.cos(o.radians(this._angle))},i.prototype.y=function(t){return t!==e?(a(this,this.x(),t),this):this._magnitude*Math.sin(o.radians(this._angle))};var a=function(t,n,e){t._magnitude=o.hypotenuse(n,e),t._angle=o.degrees(Math.atan2(e,n))},s=r.Body=function(t){return n.extend(this,n.defaults({},t,{mass:0,x:0,y:0,v:new i,a:new i,forces:[],lifetime:0})),this};s.options={timestep:8,maxAdvanceTime:3e4},s.prototype.advance=function(t,n){var r=this,o=0;if(n===e&&(n=r.isVariable()?t/Math.ceil(t/s.options.timestep):t),n>0)for(stop=u(t);!stop(r,o)&&s.options.maxAdvanceTime>o;)o+=n,r.move(n);return r},s.prototype.move=function(t){var n=this,e=n.v.x(),r=n.v.y(),o=n.netForce();return n.lifetime+=t,t/=1e3,t>0&&(n.x=n.x+e*t,n.y=n.y+r*t,n.mass>0&&(n.a.x(o.x()/n.mass),n.a.y(o.y()/n.mass)),n.v.x(n.v.x()+n.a.x()*t),n.v.y(n.v.y()+n.a.y()*t)),n},s.prototype.isVariable=function(){return!!n.any(this.forces,n.isFunction)},s.prototype.netForce=function(){for(var t,e=this,r=0,o=0,a=0,s=e.forces.length;s>a;a+=1)t=n.isFunction(e.forces[a])?e.forces[a](e):e.forces[a],r+=t.x(),o+=t.y();return this._netForce=this._netForce||new i,this._netForce.x(r).y(o)},s.prototype.path=function(t,n){var e=this.clone(),r=0,o=[];if(n=n||s.options.timestep,n>0)for(stop=u(t);!stop(e,r)&&s.options.maxAdvanceTime>r;)r+=n,e.move(n),o.push({x:e.x,y:e.y,t:r});return o},s.prototype.clone=function(){var t=this,n=new s({mass:t.mass,x:t.x,y:t.y});return n.v=new r.Vector(t.v.magnitude(),t.v.angle()),n.a=new r.Vector(t.a.magnitude(),t.a.angle()),n.forces=t.forces,n};var u=function(t){return function(n,e){return e>=t}},c=r.gravity={},h=6.6e-11,f=9.8;return c.simple=function(t,n){var e=(new i).angle(-90);n=n||f;var r=function(t){return e.magnitude(n*t.mass),e};t.forces.push(r)},c.planetary=function(t,n,e){var r=h*n.mass,a=new i;e=e||2;var s=function(t){return a.magnitude(r/Math.pow(o.distance(t,n),e)*t.mass),a.angle(o.angle(t,n)),a};t.forces.push(s)},r}(this,_);