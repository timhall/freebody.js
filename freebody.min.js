// Freebody.js - Free-body mechanics / physics engine in javascript
// (c) Tim Hall - https://github.com/timhall/freebody.js - License: MIT

(function(t,e){var n="underscore";"object"==typeof exports?module.exports=e(require(n)):"function"==typeof define&&define.amd?define([n],e):t.freebody=e(t._)})(this,function(t){"use strict";var e={},n=e.utils={};n.radians=function(t){return t*(Math.PI/180)},n.degrees=function(t){return t*(180/Math.PI)},n.hypotenuse=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))},n.roundToDec=function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},n.roundToPrecision=function(t,e){var o=Math.round(n.log10(1/(e||1)));return n.roundToDec(t,o)},n.log10=function(t){return Math.log(t)/Math.LN10},n.distance=function(t,e){return n.hypotenuse(t.x-e.x,t.y-e.y)},n.angle=function(t,e){return n.degrees(Math.atan2(e.y-t.y,e.x-t.x))};var o=e.Vector=function(t,e){return this._magnitude=t||0,this._angle=e||0,this};o.prototype.magnitude=function(t){return void 0!==t?(this._magnitude=t,this):this._magnitude},o.prototype.angle=function(t){return void 0!==t?(this._angle=t,this):this._angle},o.prototype.x=function(t){return void 0!==t?(r(this,t,this.y()),this):this._magnitude*Math.cos(n.radians(this._angle))},o.prototype.y=function(t){return void 0!==t?(r(this,this.x(),t),this):this._magnitude*Math.sin(n.radians(this._angle))};var r=function(t,e,o){t._magnitude=n.hypotenuse(e,o),t._angle=n.degrees(Math.atan2(o,e))},i=e.Body=function(e){return t.extend(this,t.defaults({},e,{mass:0,x:0,y:0,v:new o,a:new o,forces:[],lifetime:0})),this};i.options={timestep:8,maxAdvanceTime:3e4},i.prototype.advance=function(t,e){var n=this,o=0;if(void 0===e&&(e=n.isVariable()?t/Math.ceil(t/i.options.timestep):t),e>0)for(stop=a(t);!stop(n,o)&&i.options.maxAdvanceTime>o;)o+=e,n.move(e);return n},i.prototype.move=function(t){var e=this,n=e.v.x(),o=e.v.y(),r=e.netForce();return e.lifetime+=t,t/=1e3,t>0&&(e.x=e.x+n*t,e.y=e.y+o*t,e.mass>0&&(e.a.x(r.x()/e.mass),e.a.y(r.y()/e.mass)),e.v.x(e.v.x()+e.a.x()*t),e.v.y(e.v.y()+e.a.y()*t)),e},i.prototype.isVariable=function(){return!!t.any(this.forces,t.isFunction)},i.prototype.netForce=function(){for(var e,n=this,r=0,i=0,a=0,s=n.forces.length;s>a;a+=1)e=t.isFunction(n.forces[a])?n.forces[a](n):n.forces[a],r+=e.x(),i+=e.y();return this._netForce=this._netForce||new o,this._netForce.x(r).y(i)},i.prototype.path=function(t,e){var n=this.clone(),o=0,r=[];if(e=e||i.options.timestep,e>0)for(stop=a(t);!stop(n,o)&&i.options.maxAdvanceTime>o;)o+=e,n.move(e),r.push({x:n.x,y:n.y,t:o});return r},i.prototype.clone=function(){var t=this,n=new i({mass:t.mass,x:t.x,y:t.y});return n.v=new e.Vector(t.v.magnitude(),t.v.angle()),n.a=new e.Vector(t.a.magnitude(),t.a.angle()),n.forces=t.forces,n};var a=function(t){return function(e,n){return n>=t}},s=e.gravity={},u=6.6e-11,c=9.8;return s.simple=function(t,e){var n=(new o).angle(-90);e=e||c;var r=function(t){return n.magnitude(e*t.mass),n};t.forces.push(r)},s.planetary=function(t,e,r){var i=u*e.mass,a=new o;r=r||2;var s=function(t){return a.magnitude(i/Math.pow(n.distance(t,e),r)*t.mass),a.angle(n.angle(t,e)),a};t.forces.push(s)},e});