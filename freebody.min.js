// Freebody.js - Free-body mechanics / physics engine in javascript
// (c) Tim Hall - https://github.com/timhall/freebody.js - License: MIT

var freebody=function(){"use strict";var t={};return t.utils=function(){var t={};t.radians=function(t){return t*(Math.PI/180)},t.degrees=function(t){return t*(180/Math.PI)},t.hypotenuse=function(t,n){return Math.sqrt(Math.pow(t,2)+Math.pow(n,2))},t.roundToDec=function(t,n){var e=Math.pow(10,n);return Math.round(t*e)/e},t.roundToPrecision=function(n,e){var i=Math.round(t.log10(1/(e||1)));return t.roundToDec(n,i)},t.log10=function(t){return Math.log(t)/Math.LN10},t.distance=function(n,e){return t.hypotenuse(n.x-e.x,n.y-e.y)},t.angle=function(n,e){return t.degrees(Math.atan2(e.y-n.y,e.x-n.x))};var n={}.toString;return t.isNumber=function(t){return"number"==typeof t||"[object Number]"==n.call(t)},t.isFunction=function(t){return"function"==typeof t},t.isFunction(/x/)&&(t.isFunction=function(t){return"[object Function]"==n.call(t)}),t.any=function(t,n){for(var e,i=-1,r=t.length;r>++i&&!(e=n(t[i],i,t)););return!!e},t}(),t.Vector=function(t){var n=function(t,n){return this._magnitude=t||0,this._angle=n||0,this};n.prototype={magnitude:function(t){return void 0!==t?(this._magnitude=t,this):this._magnitude},angle:function(t){return void 0!==t?(this._angle=t,this):this._angle},x:function(n){return void 0!==n?(e(this,n,this.y()),this):this._magnitude*Math.cos(t.radians(this._angle))},y:function(n){return void 0!==n?(e(this,this.x(),n),this):this._magnitude*Math.sin(t.radians(this._angle))}};var e=function(n,e,i){n._magnitude=t.hypotenuse(e,i),n._angle=t.degrees(Math.atan2(i,e))};return n}(t.utils),t.Body=function(n,e){var i=function(t){return this.mass=t&&t.mass||0,this.x=t&&t.x||0,this.y=t&&t.y||0,this.v=t&&t.v||new n,this.a=t&&t.a||new n,this.forces=[],this.lifetime=0,this};i.options={timestep:8,maxAdvanceTime:3e4},i.prototype.advance=function(t,n){var o,s=this,a=0;if(void 0===n&&(n=s.isVariable()&&e.isNumber(t)?t/Math.ceil(t/i.options.timestep):e.isNumber(t)?t:i.options.timestep),n>0)for(o=r(t);!o(s,a)&&i.options.maxAdvanceTime>a;)a+=n,s.move(n);return s},i.prototype.move=function(t){var n=this,e=n.v.x(),i=n.v.y(),r=n.netForce();return n.lifetime+=t,t/=1e3,t>0&&(n.x=n.x+e*t,n.y=n.y+i*t,n.a.x(n.mass>0?r.x()/n.mass:0),n.a.y(n.mass>0?r.y()/n.mass:0),n.v.x(n.v.x()+n.a.x()*t),n.v.y(n.v.y()+n.a.y()*t)),n},i.prototype.isVariable=function(){return!!e.any(this.forces,e.isFunction)},i.prototype.netForce=function(){for(var t,i=this,r=0,o=0,s=0,a=i.forces.length;a>s;s+=1)t=e.isFunction(i.forces[s])?i.forces[s](i):i.forces[s],r+=t.x(),o+=t.y();return this._netForce=this._netForce||new n,this._netForce.x(r).y(o)},i.prototype.path=function(t,n){var e,o=this.clone(),s=0,a=[];if(n=n||i.options.timestep,n>0)for(e=r(t);!e(o,s)&&i.options.maxAdvanceTime>s;)s+=n,o.move(n),a.push({x:o.x,y:o.y});return window.body=o,a},i.prototype.clone=function(){var n=this,e=new i({mass:n.mass,x:n.x,y:n.y});return e.v=new t.Vector(n.v.magnitude(),n.v.angle()),e.a=new t.Vector(n.a.magnitude(),n.a.angle()),e.forces=n.forces,e};var r=function(t){return function(n,e){return e>=t}};return i}(t.Vector,t.utils),t.gravity=function(t,n){var e={},i=6.6e-11,r=9.8;return e.simple=function(n,e){var i=(new t).angle(-90);e=e||r;var o=function(t){return i.magnitude(e*t.mass),i};n.forces.push(o)},e.planetary=function(e,r,o){var s=i*r.mass,a=new t;o=o||2;var u=function(t){return a.magnitude(s/Math.pow(n.distance(t,r),o)*t.mass),a.angle(n.angle(t,r)),a};e.forces.push(u)},e}(t.Vector,t.utils),t}(this);