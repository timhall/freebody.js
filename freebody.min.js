// Freebody.js - Free-body mechanics / physics engine in javascript
// (c) Tim Hall - https://github.com/timhall/freebody.js - License: MIT

var freebody=function(){"use strict";var t={};return t.utils=function(){var t={};return t.radians=function(t){return t*(Math.PI/180)},t.degrees=function(t){return t*(180/Math.PI)},t.hypotenuse=function(t,n){return Math.sqrt(Math.pow(t,2)+Math.pow(n,2))},t.roundToDec=function(t,n){var e=Math.pow(10,n);return Math.round(t*e)/e},t.roundToPrecision=function(n,e){var i=Math.round(t.log10(1/(e||1)));return t.roundToDec(n,i)},t.log10=function(t){return Math.log(t)/Math.LN10},t.distance=function(n,e){return t.hypotenuse(n.x-e.x,n.y-e.y)},t.angle=function(n,e){return t.degrees(Math.atan2(e.y-n.y,e.x-n.x))},t.isNumber=function(t){return"number"==typeof t||"[object Number]"==toString.call(t)},t.isFunction=function(t){return"function"==typeof t},t.isFunction(/x/)&&(t.isFunction=function(t){return"[object Function]"==toString.call(t)}),t.any=function(t,n){for(var e,i=-1,r=t.length;r>++i&&!(e=n(t[i],i,t)););return!!e},t}(),t.Vector=function(t){var n=function(t,n){return this._magnitude=t||0,this._angle=n||0,this};n.prototype={magnitude:function(t){return void 0!==t?(this._magnitude=t,this):this._magnitude},angle:function(t){return void 0!==t?(this._angle=t,this):this._angle},x:function(n){return void 0!==n?(e(this,n,this.y()),this):this._magnitude*Math.cos(t.radians(this._angle))},y:function(n){return void 0!==n?(e(this,this.x(),n),this):this._magnitude*Math.sin(t.radians(this._angle))}};var e=function(n,e,i){n._magnitude=t.hypotenuse(e,i),n._angle=t.degrees(Math.atan2(i,e))};return n}(t.utils),t.Body=function(t,n){var e=function(n){return this.mass=n&&n.mass||0,this.x=n&&n.x||0,this.y=n&&n.y||0,this.v=n&&n.v||new t,this.a=n&&n.a||new t,this.forces=[],this.lifetime=0,this};e.options={timestep:8,maxAdvanceTime:3e4},e.prototype.advance=function(t,r){var o,u=this,s=0;if(void 0===r&&(r=u.isVariable()&&n.isNumber(t)?t/Math.ceil(t/e.options.timestep):n.isNumber(t)?t:e.options.timestep),r>0)for(o=i(t);!o(u,s)&&e.options.maxAdvanceTime>s;)s+=r,u.move(r);return u},e.prototype.move=function(t){var n=this,e=n.v.x(),i=n.v.y(),r=n.netForce();return n.lifetime+=t,t/=1e3,t>0&&(n.x=n.x+e*t,n.y=n.y+i*t,n.a.x(n.mass>0?r.x()/n.mass:0),n.a.y(n.mass>0?r.y()/n.mass:0),n.v.x(n.v.x()+n.a.x()*t),n.v.y(n.v.y()+n.a.y()*t)),n},e.prototype.isVariable=function(){return!!n.any(this.forces,n.isFunction)},e.prototype.netForce=function(){for(var e,i=this,r=0,o=0,u=0,s=i.forces.length;s>u;u+=1)e=n.isFunction(i.forces[u])?i.forces[u]():i.forces[u],r+=e.x(),o+=e.y();return(new t).x(r).y(o)};var i=function(t){return function(n,e){return e>=t}};return e}(t.Vector,t.utils),t.gravity=function(t,n){var e={},i=6.6e-11,r=9.8;return e.simple=function(n,e){var i=(new t).angle(-90);e=e||r;var o=function(){return i.magnitude(e*n.mass),i};n.forces.push(o)},e.planetary=function(e,r,o){var u=i*r.mass,s=new t;o=o||2;var a=function(){return s.magnitude(u/Math.pow(n.distance(e,r),o)*e.mass),s.angle(n.angle(e,r)),s};e.forces.push(a)},e}(t.Vector,t.utils),t}(this);